# Cuda Bandwidth

The code example in `cuda/cuda01_memory_bandwidth.cuf` shows the importance of using pinned memory vs pageable memory. It is from the book `CUDA Fortran for Scientists and Engineers, page 48`. The script sends an array from the host to the device and back. In my case:

```bash
bash-4.4$ ./band.o 
 
 Device: NVIDIA A100-SXM4-80GB
 Transfer size (MB):    16.00000    
 
 Pageable transfers
 Host to Device bandwidth (GB/s):     10.49521    
 Device to Host bandwidth (GB/s):     11.11934    
 
 Pinned transfers
 Host to Device bandwidth (GB/s):     24.19195    
 Device to Host bandwidth (GB/s):     23.46333    
```

Pinned transfers are MUCH faster!

The difference becomes clear if one reads through the nvidia-blog entry [How to Optimize Data transfers in CUDA C/C++](https://developer.nvidia.com/blog/how-optimize-data-transfers-cuda-cc/) or looks at the image they provide:

[!image](https://developer-blogs.nvidia.com/wp-content/uploads/2012/12/pinned-1024x541.jpg)

Non pinned data has to be copied first! This is a huge bottle neck. A more detailed explanation is in chapter 3.1 in Cuda Fortran for Scientists and engineers.

Detailed information about the graphics card should be provided with the `pgaccelinfo` command. It should look similar as seen below, where I have 4 graphics cards. 

```fortran
bash-4.4$ pgaccelinfo 

CUDA Driver Version:           .....
NVRM version:                  .........................................................................

Device Number:                 0
Device Name:                   .....................
Device Revision Number:        ...
Global Memory Size:            ...........
Number of Multiprocessors:     ...
Concurrent Copy and Execution: ...
Total Constant Memory:         .....
Total Shared Memory per Block: .....
Registers per Block:           .....
Warp Size:                     ...
Maximum Threads per Block:     ....
Maximum Block Dimensions:      ..............
Maximum Grid Dimensions:       ..........................
Maximum Memory Pitch:          ...........
Texture Alignment:             ....
Clock Rate:                    ........
Execution Timeout:             ...
Integrated Device:             ...
Can Map Host Memory:           ...
Compute Mode:                  .......
Concurrent Kernels:            ...
ECC Enabled:                   ...
Memory Clock Rate:             ........
Memory Bus Width:              .........
L2 Cache Size:                 ..............
Max Threads Per SMP:           ....
Async Engines:                 .
Unified Addressing:            ...
Managed Memory:                ...
Concurrent Managed Memory:     ...
Preemption Supported:          ...
Cooperative Launch:            ...
  Multi-Device:                ...
Default Target:                ....

Device Number:                 1
Device Name:                   .....................
Device Revision Number:        ...
Global Memory Size:            ...........
Number of Multiprocessors:     ...
Concurrent Copy and Execution: ...
Total Constant Memory:         .....
Total Shared Memory per Block: .....
Registers per Block:           .....
Warp Size:                     ...
Maximum Threads per Block:     ....
Maximum Block Dimensions:      ..............
Maximum Grid Dimensions:       ..........................
Maximum Memory Pitch:          ...........
Texture Alignment:             ....
Clock Rate:                    ........
Execution Timeout:             ...
Integrated Device:             ...
Can Map Host Memory:           ...
Compute Mode:                  .......
Concurrent Kernels:            ...
ECC Enabled:                   ...
Memory Clock Rate:             ........
Memory Bus Width:              .........
L2 Cache Size:                 ..............
Max Threads Per SMP:           ....
Async Engines:                 .
Unified Addressing:            ...
Managed Memory:                ...
Concurrent Managed Memory:     ...
Preemption Supported:          ...
Cooperative Launch:            ...
  Multi-Device:                ...
Default Target:                ....

Device Number:                 2
Device Name:                   .....................
Device Revision Number:        ...
Global Memory Size:            ...........
Number of Multiprocessors:     ...
Concurrent Copy and Execution: ...
Total Constant Memory:         .....
Total Shared Memory per Block: .....
Registers per Block:           .....
Warp Size:                     ...
Maximum Threads per Block:     ....
Maximum Block Dimensions:      ..............
Maximum Grid Dimensions:       ..........................
Maximum Memory Pitch:          ...........
Texture Alignment:             ....
Clock Rate:                    ........
Execution Timeout:             ...
Integrated Device:             ...
Can Map Host Memory:           ...
Compute Mode:                  .......
Concurrent Kernels:            ...
ECC Enabled:                   ...
Memory Clock Rate:             ........
Memory Bus Width:              .........
L2 Cache Size:                 ..............
Max Threads Per SMP:           ....
Async Engines:                 .
Unified Addressing:            ...
Managed Memory:                ...
Concurrent Managed Memory:     ...
Preemption Supported:          ...
Cooperative Launch:            ...
  Multi-Device:                ...
Default Target:                ....

Device Number:                 3
Device Name:                   .....................
Device Revision Number:        ...
Global Memory Size:            ...........
Number of Multiprocessors:     ...
Concurrent Copy and Execution: ...
Total Constant Memory:         .....
Total Shared Memory per Block: .....
Registers per Block:           .....
Warp Size:                     ...
Maximum Threads per Block:     ....
Maximum Block Dimensions:      ..............
Maximum Grid Dimensions:       ..........................
Maximum Memory Pitch:          ...........
Texture Alignment:             ....
Clock Rate:                    ........
Execution Timeout:             ...
Integrated Device:             ...
Can Map Host Memory:           ...
Compute Mode:                  .......
Concurrent Kernels:            ...
ECC Enabled:                   ...
Memory Clock Rate:             ........
Memory Bus Width:              .........
L2 Cache Size:                 ..............
Max Threads Per SMP:           ....
Async Engines:                 .
Unified Addressing:            ...
Managed Memory:                ...
Concurrent Managed Memory:     ...
Preemption Supported:          ...
Cooperative Launch:            ...
  Multi-Device:                ...
Default Target:                ....
```
